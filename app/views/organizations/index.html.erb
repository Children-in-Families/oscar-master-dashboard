<% content_for :page_title do %>
  <%= 'Instances' %>
<% end %>

<%= content_for :action do %>
  <%= link_to 'New', [:new, :organization], class: 'btn btn-primary ml-auto' %>
<% end %>

<div class="row">
  <div class="col-10">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th scope="col"><%= sort_link(@q, :full_name) %></th>
          <th scope="col"><%= sort_link(@q, :short_name) %></th>
          <th scope="col"><%= sort_link(@q, :country) %></th>
          <th scope="col"><%= sort_link(@q, :created_at) %></th>
          <th scope="col"><%= sort_link(@q, :clients_count) %></th>
          <th scope="col"><%= sort_link(@q, :referred_count) %></th>
          <th scope="col"><%= sort_link(@q, :accepted_client) %></th>
          <th scope="col"><%= sort_link(@q, :active_client) %></th>
          <th scope="col"><%= sort_link(@q, :exited_client) %></th>
          <th scope="col"><%= sort_link(@q, :referral_source_category_name) %></th>
          <th scope="col"><%= sort_link(@q, :demo, 'Demo?') %></th>
          <th scope="col">Manage</th>
        </tr>
      </thead>
      <tbody>
        <% collection.each do |instance| %>
          <tr>
            <td><%= instance.full_name %></td>
            <td><%= instance.short_name %></td>
            <td><%= instance.country&.titleize %></td>
            <td><%= format_value(instance.created_at.to_date) %></td>
            <td><%= instance.clients_count %></td>
            <td><%= instance.referred_count %></td>
            <td><%= instance.accepted_client %></td>
            <td><%= instance.active_client %></td>
            <td><%= instance.exited_client %></td>
            <td><%= instance.referral_source_category_name %></td>
            <td><%= format_value instance.demo? %></td>
            <td>
              <%= link_to 'Usage Report', usage_report_path(id: :added_cases, q: { organization_id_in: [instance.id]}), class: "mr-2" %>
              <%= link_to 'View', instance, class: "mr-2" %>
              <%= link_to 'Edit', edit_organization_path(instance), class: "mr-2" %>

              <% if instance.deletable? %>
                <%= link_to 'Delete', organization_path(instance), data: { method: :delete, confirm: "This action cannot be undone, are you sure?" } %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="col-2">
    <%= simple_form_for @q, url: organizations_path, method: :get do |f| %>
      <%= f.input :id_in, label: 'NGO', collection: Organization.pluck(:full_name, :id), input_html: { multiple: true } %>
      <%= f.input :full_name_cont, label: "Full Name" %>
      <%= f.input :short_name_cont, label: "Short Name" %>
      <%= f.input :country_in, collection: [Organization::SUPPORTED_COUNTRY.map(&:titleize), Organization::SUPPORTED_COUNTRY].transpose, label: "Country", input_html: { multiple: true } %>
      <%= f.input :demo_true, as: :boolean, label: 'Demo?' %>
      <%= f.input :integrated_true, as: :boolean, label: 'Interoperability?' %>

      <%= f.label :onboarding_date %>
      <div class="row">
        <div class="col-6">
          <%= f.input :created_at_gteq, label: false, input_html: { class: "form-control flatpickr" }, placeholder: "From" %>
        </div>
      
        <div class="col-6">
          <%= f.input :created_at_lteq, label: false, input_html: { class: "form-control flatpickr" }, placeholder: "To" %>
        </div>
      </div>

      <%= f.submit 'Submit', class: "btn btn-primary" %>
      <%= link_to "Clear Search", organizations_path  %>
    <% end %>
  </div>
</div>

